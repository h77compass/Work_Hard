{% extends "blog/base.html" %}

{% block title %}
    {% if current_category %}{{ current_category.name }} - {% elif current_tag %}{{ current_tag.name }} - {% elif current_author %}{{ current_author.username }}的文章 - {% endif %}我的个人博客
{% endblock %}

{% block content %}
    <div class="main-content">
        <!-- 页面标题 -->
        <h2 class="page-title mb-4">
            {% if current_category %}{{ current_category.name }}分类下的文章
            {% elif current_tag %}{{ current_tag.name }}标签下的文章
            {% elif current_author %}{{ current_author.username }}的文章
            {% else %}全部文章
            {% endif %}
        </h2>
        
        <!-- 文章列表 -->
        {% if posts %}
            {% for post in posts %}
                <article class="post-card">
                    <!-- 文章标题 -->
                    <h3 class="post-title">
                        <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
                    </h3>
                    
                    <!-- 文章元信息 -->
                    <div class="post-meta">
                        <span class="author"><i class="fa fa-user"></i> <a href="{% url 'blog:author_posts' post.author.id %}">{{ post.author.username }}</a></span>
                        <span class="time"><i class="fa fa-clock-o"></i> {{ post.publish_time|date:"Y-m-d H:i" }}</span>
                        <span class="category"><i class="fa fa-folder"></i> <a href="{% url 'blog:category_posts' post.category.id %}">{{ post.category.name }}</a></span>
                        <span class="views"><i class="fa fa-eye"></i> {{ post.views }} 浏览</span>
                        <span class="comments"><i class="fa fa-comment"></i> {{ post.comments.count }} 评论</span>
                    </div>
                    
                    <!-- 文章特色图片 -->
                    {% if post.featured_image %}
                        <div class="post-image mb-3">
                            <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="img-fluid rounded" style="max-height: 300px; object-fit: cover; width: 100%;">
                        </div>
                    {% endif %}
                    
                    <!-- 文章摘要 -->
                    <div class="post-excerpt mb-3">
                        {{ post.excerpt }}
                    </div>
                    
                    <!-- 文章标签 -->
                    {% if post.tags.all %}
                        <div class="post-tags mb-3">
                            <i class="fa fa-tags"></i>
                            {% for tag in post.tags.all %}
                                <a href="{% url 'blog:tag_posts' tag.id %}" class="badge bg-secondary mx-1">{{ tag.name }}</a>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <!-- 阅读全文链接 -->
                    <a href="{{ post.get_absolute_url }}" class="btn btn-primary btn-sm">阅读全文</a>
                </article>
            {% endfor %}
            
            <!-- 分页 -->
            {% if is_paginated %}
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                        {% endif %}
                        
                        {% for num in paginator.page_range %}
                            {% if num == page_obj.number %}
                                <li class="page-item active">
                                    <a class="page-link" href="#">{{ num }}</a>
                                </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
        {% else %}
            <div class="alert alert-info">
                暂无文章
            </div>
        {% endif %}
    </div>
{% endblock %}